{% extends 'template.html' %}
{% load static %}
{% block heading %}
    Order For :- <span id="orderFor">Shiv Chevli</span>
{% endblock %}
{% block Main %}
    <style>
        section{
            max-height: 80vh !important;
        }
        .order-detail{
            margin: 18px 0 !important;
        }
    </style>
    <div id="detail-view">
        <section id="orderDetail-section1">
                <div class="order-detail">
                    <h3>Name :- </h3>
                    <p>{{ data.orderName }}</p>
                </div>
                <div class="order-detail">
                    <h3>Address:- </h3>
                    <p>{{ data.address }} </p>
                </div>
                <div class="order-detail">
                    <h3>Email :- </h3>
                    <p>{{ data.email }}</p>
                </div>
                <div class="order-detail">
                    <h3>Number :- </h3>
                    <p>{{ data.mobileNumber }}</p>
                </div>
                <div class="order-detail">
                    <h3>Order Data & time :- </h3>
                    <p>{{ data.deliverDate }}</p>
                </div>
                <div class="order-detail">
                    <h3>Number of Person</h3>
                    <p>{{ data.numberOfPerson }}</p>
                </div>
                <div class="section4">


                    <a id="backBtn"
                        {% if confirm %}
                            href="{% url 'inventory:orderList' %}"
                        {% else %}
                            href="{% url 'inventory:clientTalksList' %}"
                        {% endif %}
                        class="button-remove button-style-1 cancel-btn">
                        Back
                    </a>

                    <a
                        {% if confirm %}
                            href="{% url 'inventory:orderPrint' data.orderId %}"
                        {% else %}
                            href="{% url 'inventory:orderPrintData' data.orderId "client" %}" target="_blank"
                        {% endif %}
                         class="button-remove  button-style-1 button-style-2 " id="printPdf">
                        Print
                    </a>

                    <button id="lockBtn" onclick="lockOrder({{ data.orderId }})" class="button-remove button-style-1 cancel-btn">
                    {% if confirm  %}
                        Un-lock
                    {% else %}
                        Lock
                    {% endif %}
                    </button>

                    <div id="edit-div"
                    {% if confirm %}
                        style="display: none"
                    {% endif %} >
                    <a href="{% url 'inventory:orderEdit' data.orderId  %}" id="editBtn" class="button-remove button-style-1">
                        Edit
                    </a>
                    <form  style="display: inline-block" method="post" id="deleteOrderFrom" action="{% url 'inventory:delete_order'%}" onsubmit="confirmSubmission(event)">
                        {% csrf_token %}
                        <input type="hidden" value="{{ data.orderId}}" name="orderId">
                        <button class="button-remove  button-style-1 cancel-btn" role="button" type="submit"> Delete</button>
                    </form>
                    </div>

                </div>
            </section>
        <section class="section2" id="section1">
                <h1>Item List</h1>
                <div class="item-list-box">

                    {% for dataItem in data.fields %}
                        <div class="item-box" data-itemid="{{ dataItem.id }}">
                        <h2 class="item-name">
                            <span class="item-name-text">
                                {{ dataItem.name }}
                            </span>
                            <span class="arrow">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                                    <path d="M16.293 9.293 12 13.586 7.707 9.293l-1.414 1.414L12 16.414l5.707-5.707z">
                                    </path>
                                </svg>
                            </span>
                        </h2>
                        <ul class="ingredient-list">
                            {% for key in dataItem.ingredients %}
                                <li data-ingredientId="{{ key.id }}">{{ key.name }}</li>
                            {% endfor %}
                        </ul>
                    </div>
                    {% endfor %}

                </div>
            </section>
    </div>

{% endblock %}

{% block scripts %}
    <script src="{% static 'js/orderScript.js' %}"></script>
    <script>
        function back(){
            window.history.back();
        }
        function confirmSubmission(event) {
            if (confirm("Do you Really want to delete this data ?") == false) {
                return event.preventDefault();
            }
        }

        function lockOrder(orderId){
            let btn = document.querySelector("#lockBtn");
            let backBtn = document.querySelector("#backBtn");
            let frm = document.querySelector("#edit-div");
            let pdf = document.querySelector("#printPdf");
            fetch(`/orderInventory/OrderLock/${orderId}`)
                .then(response => response.json())
                .then(data =>{
                    console.log(data);
                    if(data.lock == true){
                        console.log("order Lock")
                        btn.innerHTML = "Un-lock";
                        frm.style.display = "none";
                        pdf.traget = "_self";
                        pdf.href =`/orderInventory/OrderPrintOptions/${orderId}`;

                        backBtn.href = "/orderInventory/ConfirmOrderList";

                    }
                    else {
                        console.log("order un-Lock")
                        btn.innerHTML = "Lock";
                        frm.style.display = "block";
                        pdf.traget = "_blank";
                        pdf.href =`/orderInventory/OrderPrintData/${orderId}/client`;
                        backBtn.href = "/orderInventory/OrderList";
                    }

                })
            .catch(error=>{
                console.log(error);
            })
        }
    </script>
{% endblock %}